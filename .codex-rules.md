# Codex Rules — json_liveview_render

## Known Pitfalls
- Always run `mix format` before committing — CI runs `mix format --check-formatted` and will fail
- Use `false` (boolean), NOT `:false` (atom) for boolean config values
- Always use fully qualified module names (e.g. `JsonLiveviewRender.DevTools.render`), never bare aliases
- `mix compile --warnings-as-errors` is enforced in CI — unused aliases/imports will fail the build

## Spec Rules (CRITICAL — read before writing any test)
- Every element in a spec MUST have a `"children"` key with a list value (even if empty: `"children" => []`)
- Omitting `"children"` causes `invalid_children_type` validation error at runtime
- Every element MUST include ALL required props for its catalog type. Check the catalog definition before writing specs.
- Common required props: `section` requires `"title"`, `metric` requires `"label"` and `"value"`, `card` requires `"title"`
- Test specs that fail validation will crash with `ArgumentError` — the renderer validates strictly

## Testing
- Tests run via: `MIX_PUBSUB=0 mix test`
- Use `async: true` in ExUnit test modules where possible
- `mix test` alone may fail with `:eperm` on PubSub socket — always set `MIX_PUBSUB=0`
- Before committing new tests, mentally verify every spec element has: correct `type`, all required `props`, and `"children" => []` (or a list of child IDs)

## Style
- Follow standard Elixir formatting (enforced by `mix format`)
- Prefer pattern matching over conditionals
- Keep modules focused — one concern per module

## Architecture
- Phoenix LiveView components in `lib/json_liveview_render/`
- Tests in `test/json_liveview_render/`
- This is a library (Hex package), not a full Phoenix app — no config/ directory
